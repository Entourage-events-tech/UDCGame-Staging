<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Unity WebGL â€” UDC</title>
  <style>
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    #unity-container{display:flex;flex-direction:column;height:100vh;width:100vw;align-items:center;justify-content:center;background:#0b0f14;color:#fff}
    .topbar{width:100%;max-width:1600px;padding:10px 16px;box-sizing:border-box;display:flex;align-items:center;justify-content:space-between}
    .brand{font-weight:600}
    .canvas-wrap{width:100%;max-width:1600px;flex:1;display:flex;align-items:center;justify-content:center;padding:12px;box-sizing:border-box}
    .canvas-inner{position:relative;width:100%;height:100%;}
    canvas{display:block;width:100%;height:100%;max-height:100%;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.5)}
    .controls{display:flex;gap:8px}
    button{background:#1f2937;border:0;color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer}
    .progress-overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg, rgba(0,0,0,0.35), rgba(0,0,0,0.6));backdrop-filter:blur(2px)}
    .progress{width:60%;max-width:420px;background:rgba(255,255,255,0.08);padding:12px;border-radius:8px;text-align:center}
    .progress-bar{height:10px;background:#111;border-radius:999px;overflow:hidden;margin-top:10px}
    .progress-bar span{display:block;height:100%;width:0;transition:width 200ms}
    @media (max-aspect-ratio: 3/2){.canvas-wrap{padding:6px}}
    @media (max-width:640px){
      .topbar{padding:10px}
      .brand{font-size:14px}
      .controls button{padding:6px 8px;font-size:14px}
      .progress{width:86%}
    }
  </style>
</head>
<body>
  <div id="unity-container">
    <div class="topbar">
      <div class="brand">UDC Digital Connect</div>
    </div>

    <div class="canvas-wrap">
      <div class="canvas-inner" id="canvasInner">
        <div id="unity-canvas-wrapper" style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center">
          <canvas id="unity-canvas"></canvas>
          <div class="progress-overlay" id="progressOverlay">
            <div class="progress">
              <div id="progressText">Preparing player...</div>
              <div class="progress-bar"><span id="progressBar"></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* --- SETUP WITH YOUR UNITY BUILD FILES --- */
    const buildFolder = './Build'; 
    const loaderUrl   = buildFolder + '/HTML.loader.js';
    const dataUrl     = buildFolder + '/HTML.data';
    const frameworkUrl= buildFolder + '/HTML.framework.js';
    const codeUrl     = buildFolder + '/HTML.wasm';

    const canvas = document.getElementById('unity-canvas');
    const progressOverlay = document.getElementById('progressOverlay');
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');
    let unityInstance = null;

    function loadScript(src){
      return new Promise((res, rej) => {
        const s = document.createElement('script');
        s.src = src;
        s.onload = res;
        s.onerror = rej;
        document.head.appendChild(s);
      });
    }

    function resizeCanvas(){
      const parent = canvas.parentElement;
      const rect = parent.getBoundingClientRect();
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      canvas.style.width = rect.width + 'px';
      canvas.style.height = rect.height + 'px';
      canvas.width = Math.floor(rect.width * dpr);
      canvas.height = Math.floor(rect.height * dpr);
    }

    window.addEventListener('resize', resizeCanvas);

    (async function initUnity(){
      try{
        await loadScript(loaderUrl);
        resizeCanvas();
        unityInstance = await createUnityInstance(canvas, {
          dataUrl: dataUrl,
          frameworkUrl: frameworkUrl,
          codeUrl: codeUrl,
          streamingAssetsUrl: "StreamingAssets",
          companyName: "UDC",
          productName: "UDC Digital Connect",
          productVersion: "1.0"
        }, (progress)=>{
          const pct = Math.round(progress * 100);
          progressBar.style.width = pct + '%';
          progressText.textContent = 'Loading: ' + pct + '%';
          if (progress >= 1) setTimeout(()=>{ progressOverlay.style.display='none'; }, 300);
        });
      }catch(err){
        progressText.textContent = 'Player failed to load.';
        progressBar.style.width = '100%';
        console.error(err);
      }
    })();

    document.getElementById('fullscreenBtn').addEventListener('click', ()=>{
      if (canvas.requestFullscreen) canvas.requestFullscreen();
      else if (canvas.webkitRequestFullscreen) canvas.webkitRequestFullscreen();
      else if (canvas.msRequestFullscreen) canvas.msRequestFullscreen();
    });

    document.getElementById('downloadBtn').addEventListener('click', ()=>{
      window.open(buildFolder + '/UDC_Build.zip', '_blank');
    });

    canvas.addEventListener('touchmove', (e)=>{ if (e.target === canvas) e.preventDefault(); }, {passive:false});
  </script>
</body>
</html>
